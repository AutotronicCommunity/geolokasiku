<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR GPS Model</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- A-Frame + AR.js + GPS -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-gps-camera/dist/aframe-gps-camera.min.js"></script>
    <script src="https://unpkg.com/aframe-gps-entity-place/dist/aframe-gps-entity-place.min.js"></script>

    <style>
      body, html { margin: 0; padding: 0; overflow: hidden; }
      #loading {
        position: absolute;
        top: 10px;
        left: 10px;
        padding: 10px;
        background: rgba(0,0,0,0.6);
        color: white;
        font-family: sans-serif;
        z-index: 10;
      }
    </style>
  </head>

  <body>
    <div id="loading">üìç Mengambil lokasi GPS... Dekatkan ke titik koordinat -8.2241, 114.3749</div>

    <a-scene 
      vr-mode-ui="enabled: false" 
      embedded
      arjs="sourceType: webcam; gpsMinAccuracy: 100; debugUIEnabled: false;"
    >
      <a-camera gps-camera rotation-reader></a-camera>

      <!-- MODEL 3D AKTIF DI KOORDINAT INI -->
      <a-entity
        gps-entity-place="latitude: -8.2241; longitude: 114.3749;"
        gltf-model="https://cdn.glitch.global/5a88fe2d-cf57-45e1-97c0-75860f1831f5/astronaut.glb?v=1684350441444"
        scale="1 1 1"
        rotation="0 180 0"
        position="0 0 0"
      ></a-entity>
    </a-scene>

    <script>
      // Debugging - Cek apakah kamera berhasil diinisialisasi
      window.addEventListener('camera-init', () => {
        console.log('‚úÖ Kamera berhasil diinisialisasi.');
        document.getElementById('loading').innerHTML = "üì° Kamera berhasil aktif! Menunggu lokasi GPS...";
      });

      // Debugging - Cek jika ada kesalahan akses kamera
      window.addEventListener('camera-error', (error) => {
        console.error('‚ùå Gagal mengakses kamera:', error);
        alert("‚ùå Kamera tidak dapat diakses. Pastikan izin kamera diberikan di browser.");
        document.getElementById('loading').innerHTML = "‚ùå Gagal mengakses kamera.";
      });

      // Update status saat posisi GPS diperbarui
      window.addEventListener('gps-camera-update-position', (e) => {
        const lat = e.detail.position.latitude.toFixed(5);
        const lon = e.detail.position.longitude.toFixed(5);
        console.log(`üìç Lokasi Anda diperbarui: Latitude: ${lat}, Longitude: ${lon}`);
        document.getElementById('loading').innerHTML = `üìç Lokasi Anda: (${lat}, ${lon})`;
      });

      // Cek apakah GPS berhasil didapat
      window.addEventListener('gps-camera-error', (error) => {
        console.error('‚ùå Gagal mendapatkan lokasi GPS:', error);
        document.getElementById('loading').innerHTML = "‚ùå Gagal mendapatkan lokasi GPS. Pastikan izin lokasi diberikan.";
      });
    </script>
  </body>
</html>
